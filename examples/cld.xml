<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
  Sample configuration file
  Geoff Johnson <geoff.jay@gmail.com>
  2011-01-28
-->
<cld xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="cld.xsd">

    <!-- name of the application using this configuration -->
    <cld:property name="app">CRDC</cld:property>

    <!-- all of the objects should be loaded as a single treemap by the builder class -->
    <cld:objects>

        <!-- daq hardware configuration -->
        <cld:object id="daq0" type="daq">
            <!-- daq rate in hz -->
            <cld:property name="rate">10.0</cld:property>
            <cld:object id="dev0" type="device" driver="comedi">
                <cld:property name="hardware">PCI-1713</cld:property>
                <cld:property name="type">input</cld:property>
                <cld:property name="file">/dev/comedi0</cld:property>
            </cld:object>
            <cld:object id="dev1" type="device" driver="comedi">
                <cld:property name="hardware">PCI-1720</cld:property>
                <cld:property name="type">output</cld:property>
                <cld:property name="file">/dev/comedi1</cld:property>
            </cld:object>
            <!-- virtual device to handle virtual channels -->
            <cld:object id="vdev0" type="device" driver="virtual">
                <cld:property name="hardware">VDEV-0</cld:property>
                <cld:property name="type">input</cld:property>
                <!-- wonder if it's possible to use a pipe for this -->
                <cld:property name="file">/dev/null</cld:property>
            </cld:object>
        </cld:object>

        <!-- log files configuration -->
        <cld:object id="log0" type="log">
            <!-- path should end in / for now -->
            <cld:property name="title">Data Log</cld:property>
            <cld:property name="path">./</cld:property>
            <cld:property name="file">log.dat</cld:property>
            <cld:property name="format">%F-%T</cld:property>
            <!-- log rate in hz -->
            <cld:property name="rate">10.000</cld:property>
            <cld:object id="col0" type="column" chref="ai0"/>
            <cld:object id="col1" type="column" chref="ai1"/>
            <cld:object id="col2" type="column" chref="ao0"/>
            <cld:object id="col3" type="column" chref="di0"/>
            <cld:object id="col4" type="column" chref="do0"/>
        </cld:object>

        <!-- pid control loop configuration -->
        <cld:object id="ctl0" type="control">
            <cld:object id="pid0" type="pid">
                <cld:property name="dt">10</cld:property>
                <cld:property name="sp">0.000000</cld:property>
                <cld:property name="kp">0.100000</cld:property>
                <cld:property name="ki">0.100000</cld:property>
                <cld:property name="kd">0.100000</cld:property>
                <cld:object id="pv0" type="process_value" chref="ai0"/>
                <cld:object id="pv1" type="process_value" chref="ao0"/>
            </cld:object>
        </cld:object>

        <!-- channel calibrations for scaling process values -->
        <cld:object id="cal0" type="calibration">
            <!-- number of coefficients determines the order -->
            <cld:property name="units">Volts</cld:property>
            <!-- n determines the exponent - y = a[1]*x^1 + a[0]*x^0 -->
            <cld:object id="cft0" type="coefficient">
                <cld:property name="n">0</cld:property>
                <cld:property name="value">0.000</cld:property>
            </cld:object>
            <cld:object id="cft1" type="coefficient">
                <cld:property name="n">1</cld:property>
                <cld:property name="value">1.000</cld:property>
            </cld:object>
        </cld:object>
        <cld:object id="cal1" type="calibration">
            <cld:property name="units">Volts</cld:property>
            <cld:object id="cft0" type="coefficient">
                <cld:property name="n">0</cld:property>
                <cld:property name="value">0.000</cld:property>
            </cld:object>
            <cld:object id="cft1" type="coefficient">
                <cld:property name="n">1</cld:property>
                <cld:property name="value">1.000</cld:property>
            </cld:object>
        </cld:object>
        <cld:object id="cal2" type="calibration">
            <cld:property name="units">Volts</cld:property>
            <cld:object id="cft0" type="coefficient">
                <cld:property name="n">0</cld:property>
                <cld:property name="value">0.000</cld:property>
            </cld:object>
            <cld:object id="cft1" type="coefficient">
                <cld:property name="n">1</cld:property>
                <cld:property name="value">1.000</cld:property>
            </cld:object>
        </cld:object>

        <!-- analog channel definitions -->
        <cld:object id="ai0" type="channel" ref="dev0" ctype="analog" direction="input">
            <cld:property name="tag">IN0</cld:property>
            <cld:property name="desc">Sample Input</cld:property>
            <cld:property name="num">0</cld:property>
            <cld:property name="calref">cal0</cld:property>
        </cld:object>
        <cld:object id="ai1" type="channel" ref="dev0" ctype="analog" direction="input">
            <cld:property name="tag">IN1</cld:property>
            <cld:property name="desc">Sample Input</cld:property>
            <cld:property name="num">1</cld:property>
            <cld:property name="calref">cal1</cld:property>
        </cld:object>
        <cld:object id="ao0" type="channel" ref="dev1" ctype="analog" direction="output">
            <cld:property name="tag">OUT0</cld:property>
            <cld:property name="desc">Sample Output</cld:property>
            <cld:property name="num">0</cld:property>
            <cld:property name="calref">cal2</cld:property>
        </cld:object>
        <!-- virtual channels combine channels with simple math -->
        <cld:object id="vai0" type="channel" ref="vdev0" ctype="calculation" direction="input">
            <cld:property name="tag">VIN0</cld:property>
            <cld:property name="desc">Sample Virtual Input</cld:property>
            <cld:property name="num">2</cld:property>
            <cld:property name="expression">(ai0)+(ai1)</cld:property>
        </cld:object>
        <!-- digital channel definitions -->
        <cld:object id="di0" type="channel" ref="dev0" ctype="digital" direction="input">
            <cld:property name="tag">DIN0</cld:property>
            <cld:property name="desc">Sample Input</cld:property>
            <cld:property name="num">0</cld:property>
        </cld:object>
        <cld:object id="do0" type="channel" ref="dev1" ctype="digital" direction="output">
            <cld:property name="tag">DOUT0</cld:property>
            <cld:property name="desc">Sample Output</cld:property>
            <cld:property name="num">0</cld:property>
        </cld:object>
    </cld:objects>
</cld>
